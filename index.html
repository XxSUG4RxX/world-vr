<html>
  <head>
    <title>Setup</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.7/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <a-scene>

      <!-- Player. -->
      <a-entity id="rig" movement-controls="constrainToNavMesh: true; speed: 0.2">
        <a-entity
          camera
          
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true">
          <a-cursor></a-cursor>
        </a-entity>

        <a-entity
          oculus-hand="hand: left"
          laser-controls="hand: left"
          raycaster="objects: .clickable">
        </a-entity>

        <a-entity
          oculus-hand="hand: right"
          laser-controls="hand: right"
          raycaster="objects: .clickable">
        </a-entity>
      </a-entity>

      <a-assets>
        <img id="bg1" src="./asset/bg/bg1.svg"></img>
        <a-asset-item id="test" src="./asset/wizardtable.glb"></a-asset-item>
        <a-asset-item id="salle" src="./asset/scool.glb"></a-asset-item>
        <a-asset-item id="hexa" src="./asset/hexatex.glb"></a-asset-item>
        <a-asset-item id="shimmer" src="./asset/shimmer.glb"></a-asset-item>
        <a-asset-item id="flopnavmesh" src="./asset/navmesh.glb"></a-asset-item>
        <a-asset-item id="navmesh" src="./asset/simplemesh.glb"></a-asset-item>
      </a-assets>

      <!-- NavMesh avec flopnavmesh -->
      <a-entity
        id="navmeshEntity"
        gltf-model="#flopnavmesh"
        nav-mesh
        position="0 -.5 -3"
        rotation="0 -90 0"
        scale="1 1 1"
        visible="true">
      </a-entity>

      <!-- HEXA -->

      <a-entity
        gltf-model="#hexa"
        position="-0.5 .75 -2.35"
        scale=".5 .5 .5"></a-entity>

      <!-- SHIMMER -->

        <a-entity
        id="shimmer"
        gltf-model="#shimmer"
        position="0.38 .75 -1.83"
        scale=".5 .5 .5"
        class="clickable">
      </a-entity>

        <a-text 
        id="choiceText"
        value="Faite votre choix" 
        position="-0.7 2 -3" 
        rotation="0 0 0" 
        scale="1 1 1" 
        color="#FFFFFF">
      </a-text>

      <a-entity
        gltf-model="#salle"
        position="0 0 -3"
        rotation="0 -90 0"
        scale="1 1 1"></a-entity>

      <a-plane
        src="#bg1"
        position="0 0 -100"
        scale="250 125 250">
      </a-plane>

      <a-sky color="#1E816A"></a-sky>
    </a-scene>

    <script>
      // JavaScript pour cacher le texte lors du clic
      document.querySelector('#shimmer').addEventListener('click', function () {
        document.querySelector('#choiceText').setAttribute('visible', 'false');
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
          const navmeshEntity = document.querySelector('#navmeshEntity');
          
          if (navmeshEntity) {
              // On attend que le modèle soit complètement chargé
              navmeshEntity.addEventListener('loaded', () => {
                  // On ajoute dynamiquement le composant nav-mesh
                  navmeshEntity.setAttribute("nav-mesh", "");
                  console.log("✅ Composant nav-mesh ajouté dynamiquement après le chargement du modèle !");
              });
          } else {
              console.log("❌ Le NavMesh n'est pas trouvé !");
          }
      });
    </script>
    
  </body>
</html>
